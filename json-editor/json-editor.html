<!DOCTYPE html>
<html>
  <head>
    <!-- Page adapted from https://github.com/jdorn/json-editor/blob/master/examples/basic.html-->
    <meta charset="utf-8" />
    <title>Boutiques JSON Editor</title>
    <script src="./jdorn-json-editor/jsoneditor.js"></script>
    <!-- Foundation CSS framework -->
    <link rel='stylesheet' href='http://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css'>
    <!-- Font Awesome icons (Bootstrap, Foundation, and jQueryUI also supported) -->
    <link rel='stylesheet' href='http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.3/css/font-awesome.css'>
    <script>
      // Set the default CSS theme and icon library globally
      JSONEditor.defaults.theme = 'bootstrap3';
      JSONEditor.defaults.iconlib = 'fontawesome4';
      // Object layout
      JSONEditor.defaults.options.object_layout='grid';
    </script>
  </head>
  <body>
    
    <div class='span8 col-md-8 columns eight large-8'>
      
      <h2>Editor</h2>
      <div id='editor_holder'></div>
      
    </div>
    
    <div class='span4 col-md-4 columns four large-4'>
      
      <h2>Output</h2>
      <textarea id='output' style='width: 100%; height: 300px; font-family: monospace;' class='form-control'></textarea>
      
      <h2>Validation</h2>
      <span id='valid_indicator'></span>
      <textarea id='validate' style='width: 100%; height: 500px; font-family: monospace;' readonly disabled class='form-control'></textarea>
      
    </div>
    
    <script>
      // Initialize the editor with JSON schema
      var editor = new JSONEditor(document.getElementById('editor_holder'),{
      schema:{
      "$schema": "http://json-schema.org/draft-04/schema#",
      "id": "http://github.com/boutiques/boutiques-schema",
      "type": "object",
      "title": "Tool",
      "properties": {
      "name": {
      "id": "http://github.com/boutiques/boutiques-schema/name",
      "minLength": 1,
      "description": "Tool name.",
      "type": "string"
      },
      "tool-version": {
      "id": "http://github.com/boutiques/boutiques-schema/description",
      "minLength": 1,
      "description": "Tool version.",
      "type": "string"
      },
      "description": {
      "id": "http://github.com/boutiques/boutiques-schema/description",
      "minLength": 1,
      "description": "Tool description.",
      "type": "string"
      },
      "command-line": {
      "id": "http://github.com/boutiques/boutiques-schema/command-line",
      "minLength": 1,
      "description": "A string that describes the tool command line, where input and output values are identified by \"keys\". At runtime, command-line keys are substituted with flags and values.",
      "type": "string"
      },
      "docker-image": {
      "id": "http://github.com/boutiques/boutiques-schema/docker-image",
      "minLength": 1,
      "description": "Name of a Docker image where tool is installed and configured. Example: docker.io/neurodebian.",
      "type": "string"
      },
      "docker-index": {
      "id": "http://github.com/boutiques/boutiques-schema/docker-index",
      "minLength": 1,
      "description": "Docker index where Docker image is available.",
      "default": "http://index.docker.io",
      "type": "string"
      },
      "schema-version": {
      "id": "http://github.com/boutiques/boutiques-schema/schema-version",
      "type": "string",
      "description": "Version of the schema used.",
      "enum": ["0.2-snapshot"]
      },
      "inputs": {
      "id": "http://github.com/boutiques/boutiques-schema/inputs",
      "type": "array",
      "items": {
      "id": "http://github.com/boutiques/boutiques-schema/input",
      "type": "object",
      "properties": {
      "name": {
      "id": "http://github.com/boutiques/boutiques-schema/input/name",
      "minLength": 1,
      "description": "Input name.",
      "type": "string"
      },
      "type": {
      "id": "http://github.com/boutiques/boutiques-schema/input/type",
      "type": "string",
      "description": "Input type.",
      "enum": ["String", "File", "Flag" , "Numeric" ]
      },
      "description": {
      "id": "http://github.com/boutiques/boutiques-schema/input/description",
      "minLength": 1,
      "description": "Input description.",
      "type": "string"
      },
      "command-line-key": {
      "id": "http://github.com/boutiques/boutiques-schema/input/command-line-key",
      "minLength": 1,
      "description": "A string contained in command-line, substituted by the input value and/or flag at runtime.",
      "type": "string"
      },
      "list": {
      "id": "http://github.com/boutiques/boutiques-schema/input/list",
      "description":"True if input is a list of value. An input of type \"Flag\" cannot be a list.",
      "type": "boolean"
      },
      "optional":{
      "id": "http://github.com/boutiques/boutiques-schema/input/optional",
      "description": "True if input is optional.",
      "type": "boolean"
      },
      "command-line-flag":{
      "id": "http://github.com/boutiques/boutiques-schema/input/command-line-flag",
      "minLength": 1,
      "description": "Option flag of the input, involved in the command-line-key substitution. Examples: -v, --force.",
      "type": "string"
      }
      },
      "required": [
      "name",
      "description",
      "type"
      ]
      }
      },
      "output-files": {
      "id": "http://github.com/boutiques/boutiques-schema/output-files",
      "type": "array",
      "items": {
      "id": "http://github.com/boutiques/boutiques-schema/output",
      "type": "object",
      "properties": {
      "name": {
      "id": "http://github.com/boutiques/boutiques-schema/output/name",
      "description": "Output name",
      "minLength": 1,
      "type": "string"
      },
      "description": {
      "id": "http://github.com/boutiques/boutiques-schema/output/description",
      "description": "Output description.",
      "minLength": 1,
      "type": "string"
      },
      "command-line-key": {
      "id": "http://github.com/boutiques/boutiques-schema/output/command-line-key",
      "description": "A string contained in command-line, substituted by the output value and/or flag at runtime.",
      "minLength": 1,
      "type": "string"
      },
      "path-template": {
      "id": "http://github.com/boutiques/boutiques-schema/output/path-template",
      "description": "Describes the output file path relatively to the execution directory. May contain input command-line-keys. Example: \"results/[INPUT1]_brain.mnc\".",
      "minLength": 1,
      "type": "string"
      },
      "list": {
      "id": "http://github.com/boutiques/boutiques-schema/output/list",
      "description": "True if output is a list of value.",
      "type": "boolean"
      },
      "optional":{
      "id": "http://github.com/boutiques/boutiques-schema/output/optional",
      "description": "True if output may not be produced by the tool.",
      "type": "boolean"
      },
      "command-line-flag":{
      "id": "http://github.com/boutiques/boutiques-schema/output/command-line-flag",
      "minLength": 1,
      "description": "Option flag of the output, involved in the command-line-key substitution. Examples: -o, --output",
      "type": "string"
      }
      
      },
      "required": [
      "name",
      "description",
      "path-template"
      ]
      }
      }
      },
      "required": [
      "name",
      "description",
      "command-line",
      "schema-version",
      "inputs",
      "output-files"
      ]
      }
      });
      
      
      var $validate = document.getElementById('validate');
      var $output = document.getElementById('output');
      var indicator = document.getElementById('valid_indicator');
      
      // When the value of the editor changes, update the JSON output and validation message
      editor.on('change',function() {
      var json = editor.getValue();
      
      $output.value = JSON.stringify(json,null,2);
      
      var validation_errors = editor.validate();
      
      
      // Update validation indicator
      if(validation_errors.length) {
      indicator.style.color = 'red';
      indicator.textContent = "not valid";
      }
      else {
      indicator.style.color = 'green';
      indicator.textContent = "valid";
      }
      
      // Show validation errors if there are any
      if(validation_errors.length) {
      $validate.value = JSON.stringify(validation_errors,null,2);
      }
      else {
      $validate.value = 'No error';
      }
      
      });
    </script>
  </body>
</html>
